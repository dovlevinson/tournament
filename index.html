<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Moriah 3v3 Chanukah Basketball Tournament</title>
  <style>
    :root {
      /* Chanukah Calendar Theme */
      --bg: #dbeafe;          /* Light Blue Background */
      --surface: #ffffff;     /* White Card Body */
      --surface-highlight: #eff6ff;
      --stroke: #bfdbfe;      /* Light Blue Borders */
      --text: #1e3a8a;        /* Dark Blue Text */
      --text-muted: #64748b;  /* Muted Blue-Gray */
      --brand: #facc15;       /* Bright Gold/Yellow */
      --brand-blue: #3b82f6;  /* Action Blue */
      --danger: #ef4444;      /* Red */
      
      --header-bg: #1e3a8a;   /* Deep Royal Blue for Headers */
      --header-text: #fefce8; /* Off-white/Gold text */
      
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(30, 58, 138, 0.15), 0 2px 4px -1px rgba(30, 58, 138, 0.1);
      --card-shadow: 4px 4px 0px rgba(30, 58, 138, 0.15); /* Pop shadow effect */
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      color: var(--text);
      background-color: var(--bg);
      background-image: radial-gradient(at top center, #eff6ff 0%, #dbeafe 100%);
      background-attachment: fixed;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Layout & Header */
    header {
      flex-shrink: 0;
      z-index: 50;
      background: var(--header-bg);
      border-bottom: 4px solid var(--brand);
      padding: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .topbar {
      max-width: 1800px;
      margin: 0 auto;
      display: flex;
      flex-wrap: nowrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: space-between;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .topbar::-webkit-scrollbar { display: none; }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 800; /* Extra bold */
      font-size: 1rem;
      color: var(--brand);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
      text-shadow: 1px 1px 0px rgba(0,0,0,0.3);
      flex-shrink: 1;
      min-width: 0;
      overflow: hidden; text-overflow: ellipsis;
    }
    
    .brand svg { stroke: var(--brand); width: 20px; height: 20px; }

    .controls {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    button.icon-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #93c5fd;
      border-radius: 6px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.2s;
    }
    button.icon-btn:hover { background: rgba(255,255,255,0.2); color: var(--brand); }
    button.icon-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    
    .tabs {
      display: flex;
      background: rgba(0,0,0,0.2);
      padding: 3px;
      border-radius: 99px;
      border: 1px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
    }

    .tab {
      background: transparent;
      border: none;
      color: #bfdbfe;
      padding: 4px 12px;
      border-radius: 99px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .tab[aria-selected="true"] {
      background: var(--brand);
      color: var(--header-bg);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    main {
      flex: 1;
      width: 100%;
      padding: 0.5rem;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* Cards & Sections */
    .section { display: none; height: 100%; width: 100%; }
    .section.active { display: flex; flex-direction: column; }

    .card {
      background: var(--surface);
      border: 2px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      padding: 1rem;
      position: relative;
      overflow-y: auto;
    }

    /* --- STRICT 2x2 GRID (NO SCROLL) --- */
    .games-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 0.75rem;
        height: 100%;
        width: 100%;
    }
    
    @media (max-width: 600px) {
        .games-grid { display: flex; flex-direction: column; overflow-y: auto; }
        .pool-lane-card { min-height: 220px; flex-shrink: 0; }
    }

    /* Pool Lane Card */
    .pool-lane-card {
        background: var(--surface);
        border: 2px solid var(--header-bg);
        border-radius: var(--radius);
        padding: 0;
        display: flex;
        flex-direction: column;
        box-shadow: 4px 4px 0px rgba(30, 58, 138, 0.15);
        overflow: hidden;
        height: 100%;
    }
    
    .pool-header {
        background: var(--header-bg);
        padding: 4px 10px;
        border-bottom: 2px solid var(--header-bg);
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-shrink: 0;
    }

    .pool-title {
        font-weight: 800;
        color: var(--brand); 
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.05em;
        text-shadow: 1px 1px 0px rgba(0,0,0,0.3);
    }
    
    .header-actions { display: flex; gap: 6px; }

    .pool-toggle-btn {
        background: rgba(255,255,255,0.1);
        border: none;
        color: var(--brand);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
    }
    .pool-toggle-btn:hover { background: rgba(255,255,255,0.25); color: #fff; }
    .pool-toggle-btn.active { background: var(--brand); color: var(--header-bg); }
    
    .current-game-section {
        padding: 0.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: #fff;
        overflow: hidden;
        min-height: 0;
    }

    .section-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
        letter-spacing: 0.05em;
        font-weight: 700;
        flex-shrink: 0;
    }

    .game-body {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 0.25rem;
        width: 100%;
        flex: 1;
        min-height: 0;
        justify-content: center;
    }

    .game-team-btn {
        background: #fff;
        border: 2px solid var(--stroke);
        padding: 0 0.5rem;
        border-radius: 8px;
        color: var(--text);
        cursor: pointer;
        text-align: center;
        transition: 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        min-height: 0;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        overflow: hidden;
    }
    .game-team-btn:hover { background: #fffbeb; border-color: var(--brand); }
    .game-team-btn.blue:hover { background: #eff6ff; border-color: var(--brand-blue); }
    
    .team-name { 
        font-weight: 800; 
        font-size: 1rem; 
        line-height: 1.1; 
        color: var(--header-bg); 
        white-space: nowrap; 
        overflow: hidden; 
        width: 100%; 
        display: block;
    }
    .team-record { font-size: 0.7rem; color: var(--text-muted); font-weight: 600; margin-top: 2px; }

    .vs-text { 
        font-size: 0.75rem; font-weight: 900; color: var(--brand); 
        text-shadow: 1px 1px 0 rgba(0,0,0,0.1); text-align: center; margin: -2px 0;
    }

    .on-deck-section {
        padding: 0.4rem 0.5rem;
        background: #f8fafc;
        border-top: 1px solid var(--stroke);
        flex-shrink: 0;
    }

    .on-deck-row {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0px;
        font-size: 0.75rem;
        color: var(--text);
        font-weight: 600;
        padding: 2px;
        background: #fff;
        border-radius: 6px;
        border: 1px solid var(--stroke);
    }
    .deck-vs { font-weight: 900; color: var(--brand-blue); font-size: 0.65rem; line-height: 1; }
    .deck-team {
        width: 100%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden; 
        font-size: 0.85rem;
        line-height: 1.2;
    }

    /* Mini Standings for Card */
    .mini-standings {
        padding: 0.5rem;
        font-size: 0.8rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
    }
    .mini-table { width: 100%; border-collapse: collapse; }
    .mini-table td, .mini-table th { padding: 4px 8px; border-bottom: 1px solid var(--stroke); }
    .mini-table th { text-align: left; color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; }
    .mini-table .row-qualify { background: #f0fdf4; }
    .pool-status-msg { margin-bottom: 5px; font-weight: bold; color: var(--header-bg); text-align: center; font-size: 0.9rem; }

    /* --- BRACKET STYLES --- */
    .bracket-container {
        display: grid;
        grid-template-columns: 1fr 1fr 1.2fr 1fr 1fr;
        grid-template-rows: auto auto auto auto auto;
        gap: 5px 10px;
        width: 100%;
        height: 100%;
        align-items: center;
        justify-content: center;
    }
    
    .bracket-container.small-bracket {
        grid-template-columns: 1fr 1.2fr 1fr;
    }

    .bracket-node {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
    }

    .bracket-header-cell {
        text-align: center; font-weight: 800; color: var(--text-muted); 
        text-transform: uppercase; font-size: 0.7rem; padding-bottom: 5px; grid-row: 1; align-self: end;
    }

    .bracket-match-card {
        background: #fff;
        border: 2px solid var(--stroke);
        border-radius: 8px;
        padding: 6px 8px;
        width: 100%;
        min-width: 0;
        box-shadow: 2px 2px 0 rgba(0,0,0,0.05);
        z-index: 2;
        /* No generic cursor:pointer on parent anymore */
    }
    .bracket-match-card.active { border-color: var(--brand); box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.3); }
    
    .b-team { 
        display: flex; justify-content: space-between; align-items: center;
        font-size: 0.8rem; font-weight: 700; padding: 4px 6px; 
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        min-width: 0;
        border-radius: 4px;
        transition: background 0.15s;
    }
    .b-team.winner { color: var(--brand-blue); }
    .b-team.loser { color: var(--text-muted); opacity: 0.6; }
    
    /* Interactive Team in Bracket */
    .b-team.team-pick { cursor: pointer; }
    .b-team.team-pick:hover { background-color: #eff6ff; color: var(--brand-blue); }
    
    /* Layout Positions */
    .node-qf1 { grid-column: 1; grid-row: 2; }
    .node-qf2 { grid-column: 1; grid-row: 5; }
    .node-semi1 { grid-column: 2; grid-row: 2 / span 4; }
    .node-qf3 { grid-column: 5; grid-row: 2; }
    .node-qf4 { grid-column: 5; grid-row: 5; }
    .node-semi2 { grid-column: 4; grid-row: 2 / span 4; }
    .node-final { grid-column: 3; grid-row: 2 / span 4; }
    
    .small-bracket .node-semi1 { grid-column: 1; grid-row: 2; }
    .small-bracket .node-semi2 { grid-column: 3; grid-row: 2; }
    .small-bracket .node-final { grid-column: 2; grid-row: 2; }
    
    .node-final .bracket-match-card { 
        border-color: var(--brand); border-width: 3px; transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(250, 204, 21, 0.3);
    }

    /* Connectors */
    .node-qf1::after { content: ''; position: absolute; z-index: 1; right: -50%; top: 50%; width: 50%; height: 150%; border-right: 2px solid var(--stroke); border-bottom: 2px solid var(--stroke); }
    .node-qf2::after { content: ''; position: absolute; z-index: 1; right: -50%; bottom: 50%; width: 50%; height: 150%; border-right: 2px solid var(--stroke); border-top: 2px solid var(--stroke); }
    .node-semi1::after { content: ''; position: absolute; z-index: 1; right: -50%; top: 50%; width: 50%; height: 2px; background: var(--stroke); }

    .node-qf3::after { content: ''; position: absolute; z-index: 1; left: -50%; top: 50%; width: 50%; height: 150%; border-left: 2px solid var(--stroke); border-bottom: 2px solid var(--stroke); }
    .node-qf4::after { content: ''; position: absolute; z-index: 1; left: -50%; bottom: 50%; width: 50%; height: 150%; border-left: 2px solid var(--stroke); border-top: 2px solid var(--stroke); }
    .node-semi2::after { content: ''; position: absolute; z-index: 1; left: -50%; top: 50%; width: 50%; height: 2px; background: var(--stroke); }
    
    .small-bracket .node-semi1::after { content: ''; position: absolute; z-index: 1; right: -50%; top: 50%; width: 50%; height: 2px; background: var(--stroke); border: none; }
    .small-bracket .node-semi2::after { content: ''; position: absolute; z-index: 1; left: -50%; top: 50%; width: 50%; height: 2px; background: var(--stroke); border: none; }

    .champion-banner {
        text-align: center; background: linear-gradient(135deg, var(--brand), #fde047);
        padding: 1rem; margin-top: 0.5rem; border-radius: var(--radius);
        box-shadow: 0 4px 15px rgba(250, 204, 21, 0.4); border: 2px solid #fff;
    }
    .champ-title { font-size: 0.7rem; color: #854d0e; font-weight: 800; letter-spacing: 0.2em; }
    .champ-name { font-size: 1.5rem; color: var(--header-bg); font-weight: 900; text-transform: uppercase; line-height: 1.1; }

    /* FIXED MODAL STYLES */
    .modal-overlay { position: fixed; inset: 0; background: rgba(30, 58, 138, 0.6); backdrop-filter: blur(2px); z-index: 100; display: none; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }
    .modal {
        background: var(--surface);
        width: 90%; max-width: 500px;
        display: flex; flex-direction: column;
        max-height: 85vh;
        border-radius: var(--radius);
        border: 2px solid var(--header-bg);
        padding: 0;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    }
    .modal-header { 
        display: flex; justify-content: space-between; align-items: center; 
        padding: 1rem 1.5rem; border-bottom: 1px solid var(--stroke); flex-shrink: 0;
    }
    .modal-body {
        padding: 1.5rem; overflow-y: auto; flex: 1;
    }
    .modal-footer {
        padding: 1rem 1.5rem; border-top: 1px solid var(--stroke); flex-shrink: 0; text-align: right;
    }
    
    .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted); }
    .team-edit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
    .input-group { display: flex; flex-direction: column; gap: 4px; }
    .input-group label { font-size: 0.75rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; }
    
    .generate-btn { width: 100%; padding: 0.75rem; background: var(--brand); color: var(--header-bg); border: none; font-weight: 800; border-radius: 8px; cursor: pointer; }
    .select-input, input[type="text"], textarea { width: 100%; padding: 8px; border: 2px solid var(--stroke); border-radius: 6px; background: #f8fafc; color: var(--text); font-weight: 600; margin-bottom: 0.5rem; }

    .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--header-bg); color: var(--brand); padding: 8px 16px; border-radius: 99px; font-weight: 700; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 200; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
    .undo-container { text-align: center; margin-top: 5px; }
    .undo-btn { background: none; border: none; color: var(--text-muted); text-decoration: underline; cursor: pointer; font-size: 0.8rem; }
    .undo-btn:hover { color: var(--danger); font-weight: bold; }
    .bracket-projected-header { text-align: center; padding: 0.5rem; margin-bottom: 0.5rem; color: var(--header-bg); font-weight: 700; background: #eff6ff; border: 1px dashed var(--brand-blue); border-radius: 8px; font-size: 0.85rem; }

    /* HISTORY MODAL STYLES */
    .history-list { font-size: 0.85rem; }
    .history-item { padding: 8px 0; border-bottom: 1px solid var(--stroke); display: flex; justify-content: space-between; align-items: center; }
    .history-winner { color: var(--brand-blue); font-weight: 700; }
    .history-loser { color: var(--text-muted); opacity: 0.7; }
    .empty-history { text-align: center; color: var(--text-muted); padding: 20px; font-style: italic; }

    /* SEEDING FORM STYLES */
    .seeding-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
    .seeding-label { width: 80px; font-size: 0.75rem; font-weight: 700; color: var(--header-bg); }
    .seeding-select { flex: 1; }

  </style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
      Moriah 3v3 Chanukah Basketball Tournament
    </div>
    
    <nav class="tabs">
      <button class="tab" onclick="app.setTab('queue')" id="tab-btn-queue" aria-selected="true">Play</button>
      <button class="tab" onclick="app.setTab('standings')" id="tab-btn-standings">Standings</button>
      <button class="tab" onclick="app.setTab('playoffs')" id="tab-btn-playoffs">Bracket</button>
    </nav>

    <div class="controls">
      <button class="icon-btn" id="header-undo-btn" onclick="app.undo()" title="Undo Last Action" style="opacity:0.5; pointer-events:none;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
      </button>
      <button class="icon-btn" onclick="app.toggleSettings()" title="Settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
      </button>
      <button class="icon-btn" onclick="app.resetAll()" title="Reset Tournament">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
      </button>
    </div>
  </div>
</header>

<main>
  <!-- Queue Section -->
  <section id="queue" class="section active">
    <!-- Content injected via JS -->
    <div id="queue-content" style="height:100%"></div>
  </section>

  <!-- Standings Section -->
  <section id="standings" class="section">
    <div id="standings-content" style="height:100%"></div>
  </section>

  <!-- Playoffs Section -->
  <section id="playoffs" class="section">
    <div class="card" style="height:100%">
      <div id="bracket-content" style="height:100%; display:flex; flex-direction:column;"></div>
    </div>
  </section>
</main>

<!-- Settings Modal -->
<div class="modal-overlay" id="settings-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>Edit Tournament</h2>
      <button class="close-btn" onclick="app.closeModal('settings-modal')">&times;</button>
    </div>
    
    <div class="modal-body">
        <div style="margin-bottom: 1.5rem;">
            <label style="font-size:0.75rem; color:var(--text-muted); font-weight:700; text-transform:uppercase; margin-bottom:5px; display:block;">Format</label>
            <select id="team-count-select" class="select-input" onchange="app.changeFormat(this.value)">
                <option value="8">8 Teams (2 Pools of 4)</option>
                <option value="10">10 Teams (2 Pools of 5)</option>
                <option value="12">12 Teams (4 Pools of 3)</option>
                <option value="16" selected>16 Teams (4 Pools of 4) [Standard]</option>
                <option value="20">20 Teams (4 Pools of 5)</option>
                <option value="24">24 Teams (4 Pools of 6)</option>
            </select>
            <div style="font-size:0.75rem; color:var(--text-muted);">Changing format resets data.</div>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
            <label style="font-size:0.75rem; color:var(--text-muted); font-weight:700; text-transform:uppercase; margin-bottom:5px; display:block;">Bulk Import Names</label>
            <textarea id="bulk-names" rows="4" placeholder="Paste names (one per line)..."></textarea>
            <button class="generate-btn" style="width: auto; padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="app.applyBulkNames()">Apply Bulk List</button>
        </div>

        <div class="team-edit-grid" id="team-inputs"></div>
    </div>

    <div class="modal-footer">
        <button class="generate-btn" style="width:auto;" onclick="app.closeModal('settings-modal')">Done</button>
    </div>
  </div>
</div>

<!-- Format Change Confirmation Modal -->
<div class="modal-overlay" id="format-modal">
  <div class="modal" style="text-align: center; max-width: 350px;">
    <div class="modal-body">
        <h2>Change Format?</h2>
        <p style="color:var(--text-muted); margin-bottom:1.5rem;">This will erase all current progress and reset the tournament to the new team count.</p>
        <div style="display:flex; gap:10px; justify-content:center;">
          <button class="generate-btn" style="background:var(--surface-highlight); color:var(--text);" onclick="app.cancelFormatChange()">Cancel</button>
          <button class="generate-btn" style="background:var(--danger); color:white;" onclick="app.confirmFormatChange()">Change</button>
        </div>
    </div>
  </div>
</div>

<!-- Reset Confirmation Modal -->
<div class="modal-overlay" id="reset-modal">
  <div class="modal" style="text-align: center; max-width: 350px;">
    <div class="modal-body">
        <h2>Reset Tournament?</h2>
        <p style="color:var(--text-muted); margin-bottom:1.5rem;">This will erase all progress. Cannot be undone.</p>
        <div style="display:flex; gap:10px; justify-content:center;">
          <button class="generate-btn" style="background:var(--surface-highlight); color:var(--text);" onclick="app.closeModal('reset-modal')">Cancel</button>
          <button class="generate-btn" style="background:var(--danger); color:white;" onclick="app.confirmReset()">Reset</button>
        </div>
    </div>
  </div>
</div>

<!-- Pool History Modal -->
<div class="modal-overlay" id="history-modal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="history-modal-title">Pool History</h2>
      <button class="close-btn" onclick="app.closeModal('history-modal')">&times;</button>
    </div>
    <div class="modal-body" id="history-modal-content">
        <!-- Content injected via JS -->
    </div>
    <div class="modal-footer">
        <button class="generate-btn" style="width:auto;" onclick="app.closeModal('history-modal')">Close</button>
    </div>
  </div>
</div>

<!-- Bracket Seeding/Generation Modal (Manual Selection) -->
<div class="modal-overlay" id="bracket-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>Confirm Playoff Seeding</h2>
      <button class="close-btn" onclick="app.closeModal('bracket-modal')">&times;</button>
    </div>
    <div class="modal-body">
        <p style="color:var(--text-muted); margin-bottom:1rem; font-size:0.85rem;">Select top teams from each pool. (Defaults are based on wins).</p>
        <div id="seeding-form"></div>
    </div>
    <div class="modal-footer">
      <button class="generate-btn" style="background:var(--surface-highlight); color:var(--text); width:auto; margin-right:10px;" onclick="app.closeModal('bracket-modal')">Cancel</button>
      <button class="generate-btn" style="background:var(--brand); color:#000; width:auto;" onclick="app.confirmBracket()">Start Playoffs</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">Saved!</div>

<script>
class TournamentApp {
  constructor() {
    this.storageKey = 'tourney_data_v1';
    this.data = this.loadData() || this.getInitialData(16);
    this.poolViews = { A: false, B: false, C: false, D: false };
    this.pendingFormat = null;
    this.ui = {
      queue: document.getElementById('queue-content'),
      standings: document.getElementById('standings-content'),
      bracket: document.getElementById('bracket-content'),
      teamInputs: document.getElementById('team-inputs'),
      toast: document.getElementById('toast'),
    };
    
    const totalTeams = Object.keys(this.data.teams).length;
    const select = document.getElementById('team-count-select');
    if(select) select.value = totalTeams;

    this.init();
  }

  getInitialData(totalTeams = 16) {
    let pools = [];
    let teamsPerPool = 4;
    
    if (totalTeams == 8) { pools = ['A', 'B']; teamsPerPool = 4; }
    else if (totalTeams == 10) { pools = ['A', 'B']; teamsPerPool = 5; }
    else if (totalTeams == 12) { pools = ['A', 'B', 'C', 'D']; teamsPerPool = 3; }
    else if (totalTeams == 20) { pools = ['A', 'B', 'C', 'D']; teamsPerPool = 5; }
    else if (totalTeams == 24) { pools = ['A', 'B', 'C', 'D']; teamsPerPool = 6; }
    else { pools = ['A', 'B', 'C', 'D']; teamsPerPool = 4; totalTeams = 16; }

    const teams = {};
    const poolGames = [];
    let teamCount = 1;

    pools.forEach(pool => {
      const poolTeams = [];
      for(let i=0; i<teamsPerPool; i++) {
        const id = `t${teamCount}`;
        teams[id] = { id, name: `Team ${teamCount}`, pool, wins: 0, losses: 0 };
        poolTeams.push(id);
        teamCount++;
      }
      
      const rounds = this.generateRoundRobin(poolTeams);
      rounds.forEach(round => {
          round.forEach(match => {
             poolGames.push({
                id: `p_${pool}_${match.home}_${match.away}`,
                type: 'pool',
                pool,
                home: match.home,
                away: match.away,
                winner: null
             });
          });
      });
    });
    
    return { phase: 'pool', teams, poolGames, playoffGames: [], history: [] };
  }
  
  generateRoundRobin(teamsArr) {
      const schedule = [];
      if (teamsArr.length % 2 !== 0) teamsArr.push(null);
      const n = teamsArr.length;
      const rounds = n - 1;
      for (let r = 0; r < rounds; r++) {
          const roundMatches = [];
          for (let i = 0; i < n / 2; i++) {
              const home = teamsArr[i];
              const away = teamsArr[n - 1 - i];
              if (home !== null && away !== null) roundMatches.push({ home, away });
          }
          schedule.push(roundMatches);
          teamsArr.splice(1, 0, teamsArr.pop());
      }
      return schedule;
  }

  loadData() {
    try {
      const stored = localStorage.getItem(this.storageKey);
      return stored ? JSON.parse(stored) : null;
    } catch(e) { return null; }
  }

  saveData() {
    try {
      localStorage.setItem(this.storageKey, JSON.stringify(this.data));
    } catch (e) {
      if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
        this.data.history = [];
        try {
           localStorage.setItem(this.storageKey, JSON.stringify(this.data));
           this.showToast('History cleared (Space Full)');
        } catch (innerE) {}
      }
    }
  }

  init() {
    this.renderAll();
    this.setupInputs();
    this.fitText();
  }
  
  fitText() {
    const elements = document.querySelectorAll('.team-name, .b-team, .deck-team');
    elements.forEach(el => {
      let size = 16;
      if (el.classList.contains('b-team')) size = 14; 
      el.style.fontSize = '';
      while (el.scrollWidth > el.clientWidth && size > 10) {
        size--;
        el.style.fontSize = size + 'px';
      }
    });
  }

  closeModal(id) {
    document.getElementById(id).classList.remove('open');
    if(id === 'settings-modal') {
        this.saveData();
        this.renderAll();
    }
  }

  resetAll() { document.getElementById('reset-modal').classList.add('open'); }

  confirmReset() {
      this.closeModal('reset-modal');
      const size = document.getElementById('team-count-select').value;
      this.data = this.getInitialData(size);
      this.poolViews = { A: false, B: false, C: false, D: false };
      this.saveData();
      this.renderAll();
      this.setupInputs();
      this.showToast('Tournament Reset');
  }
  
  changeFormat(val) {
      this.pendingFormat = val;
      document.getElementById('format-modal').classList.add('open');
  }
  
  confirmFormatChange() {
      this.closeModal('format-modal');
      if (this.pendingFormat) {
          this.data = this.getInitialData(this.pendingFormat);
          this.poolViews = { A: false, B: false, C: false, D: false };
          this.saveData();
          this.renderAll();
          this.setupInputs();
          this.showToast('Format Changed');
      }
  }
  
  cancelFormatChange() {
      this.closeModal('format-modal');
      const totalTeams = Object.keys(this.data.teams).length;
      document.getElementById('team-count-select').value = totalTeams;
  }
  
  // NEW: POOL HISTORY
  showPoolHistory(pool) {
      const games = this.data.poolGames.filter(g => g.pool === pool && g.winner);
      const container = document.getElementById('history-modal-content');
      document.getElementById('history-modal-title').innerText = `Pool ${pool} History`;
      
      if(games.length === 0) {
          container.innerHTML = '<div class="empty-history">No completed games yet.</div>';
      } else {
          let html = '<div class="history-list">';
          games.forEach(g => {
              const hName = this.data.teams[g.home].name;
              const aName = this.data.teams[g.away].name;
              const winner = g.winner === g.home ? hName : aName;
              const loser = g.winner === g.home ? aName : hName;
              html += `<div class="history-item">
                <span class="history-winner">${winner}</span>
                <span style="font-size:0.75rem; margin:0 5px;">def.</span>
                <span class="history-loser">${loser}</span>
              </div>`;
          });
          html += '</div>';
          container.innerHTML = html;
      }
      document.getElementById('history-modal').classList.add('open');
  }

  // UPDATED: GENERATE BRACKET (SEEDING SELECTOR)
  generateBracket() {
      const standings = this.getStandings();
      const pools = Object.keys(standings);
      let formHtml = '';
      
      pools.forEach(pool => {
         const poolTeams = standings[pool];
         // Input for 1st Place
         formHtml += `<div class="seeding-row"><div class="seeding-label">Pool ${pool} #1</div>`;
         formHtml += `<select id="seed-${pool}-1" class="select-input seeding-select">`;
         poolTeams.forEach((t, i) => {
             formHtml += `<option value="${t.id}" ${i===0?'selected':''}>${t.name} (${t.wins}W)</option>`;
         });
         formHtml += `</select></div>`;
         
         // Input for 2nd Place
         formHtml += `<div class="seeding-row"><div class="seeding-label">Pool ${pool} #2</div>`;
         formHtml += `<select id="seed-${pool}-2" class="select-input seeding-select">`;
         poolTeams.forEach((t, i) => {
             formHtml += `<option value="${t.id}" ${i===1?'selected':''}>${t.name} (${t.wins}W)</option>`;
         });
         formHtml += `</select></div>`;
      });
      
      document.getElementById('seeding-form').innerHTML = formHtml;
      document.getElementById('bracket-modal').classList.add('open');
  }

  // UPDATED: CONFIRM BRACKET WITH MANUAL SEEDS
  confirmBracket() {
    this.closeModal('bracket-modal');
    const standings = this.getStandings();
    const poolKeys = Object.keys(standings);
    
    // Helper to get manual seed
    const getSeed = (pool, rank) => document.getElementById(`seed-${pool}-${rank}`).value;
    
    const createMatch = (id, r, h, a, nextId, slot) => ({ id, round: r, home: h, away: a, winner: null, nextMatchId: nextId, nextSlot: slot });
    let playoffs = [];

    if (poolKeys.length === 2) {
        // 8/10 Team Format (2 Pools) -> SEMIS & FINAL
        // A1 vs B2, B1 vs A2
        const A1 = getSeed('A', 1); const A2 = getSeed('A', 2);
        const B1 = getSeed('B', 1); const B2 = getSeed('B', 2);
        
        playoffs = [
            createMatch('final', 'Finals', null, null, null, null),
            createMatch('semi1', 'Semifinals', A1, B2, 'final', 'home'),
            createMatch('semi2', 'Semifinals', B1, A2, 'final', 'away')
        ];
    } else {
        // 12/16/20/24 Team Format (4 Pools)
        const A1 = getSeed('A', 1); const A2 = getSeed('A', 2);
        const B1 = getSeed('B', 1); const B2 = getSeed('B', 2);
        const C1 = getSeed('C', 1); const C2 = getSeed('C', 2);
        const D1 = getSeed('D', 1); const D2 = getSeed('D', 2);
        
        playoffs = [
            createMatch('final', 'Finals', null, null, null, null),
            createMatch('semi1', 'Semifinals', null, null, 'final', 'home'),
            createMatch('semi2', 'Semifinals', null, null, 'final', 'away'),
            createMatch('qf1', 'Quarterfinals', A1, B2, 'semi1', 'home'),
            createMatch('qf2', 'Quarterfinals', D1, C2, 'semi1', 'away'),
            createMatch('qf3', 'Quarterfinals', B1, A2, 'semi2', 'home'),
            createMatch('qf4', 'Quarterfinals', C1, D2, 'semi2', 'away')
        ];
    }
    this.data.playoffGames = playoffs;
    this.data.phase = 'playoff';
    this.saveData();
    this.renderAll();
    this.setTab('playoffs'); 
    this.showToast('Bracket Generated!');
  }

  setTab(tabName) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    document.querySelectorAll('.tab').forEach(btn => btn.setAttribute('aria-selected', 'false'));
    document.getElementById(`tab-btn-${tabName}`).setAttribute('aria-selected', 'true');
  }

  toggleSettings() { document.getElementById('settings-modal').classList.add('open'); }
  
  togglePoolStandings(pool) {
      this.poolViews[pool] = !this.poolViews[pool];
      this.renderQueue();
  }

  setupInputs() {
    this.ui.teamInputs.innerHTML = Object.values(this.data.teams).map(t => `
      <div class="input-group">
        <label>Pool ${t.pool}</label>
        <input type="text" value="${t.name}" onchange="app.updateName('${t.id}', this.value)">
      </div>
    `).join('');
  }

  updateName(id, name) {
    this.data.teams[id].name = name;
    this.saveData();
  }
  
  applyBulkNames() {
      const raw = document.getElementById('bulk-names').value;
      const names = raw.split('\n').map(n => n.trim()).filter(n => n);
      if(names.length === 0) { this.showToast("No names found!"); return; }
      const teamIds = Object.keys(this.data.teams);
      let count = 0;
      teamIds.forEach((id, index) => {
        if(names[index]) {
          this.data.teams[id].name = names[index];
          count++;
        }
      });
      this.saveData();
      this.setupInputs(); 
      this.renderAll();
      this.showToast(`Updated ${count} Names`);
      document.getElementById('bulk-names').value = ''; 
  }

  recordWin(gameId, winnerId) {
    const { history, ...snapshot } = this.data;
    this.data.history.push(JSON.parse(JSON.stringify(snapshot)));
    if(this.data.history.length > 30) this.data.history.shift(); 

    let game;
    if(this.data.phase === 'pool') {
      game = this.data.poolGames.find(g => g.id === gameId);
      if(game) {
        game.winner = winnerId;
        const h = this.data.teams[game.home];
        const a = this.data.teams[game.away];
        if (winnerId === game.home) { h.wins++; a.losses++; }
        else { a.wins++; h.losses++; }
      }
    } else {
      game = this.data.playoffGames.find(g => g.id === gameId);
      if(game) {
        game.winner = winnerId;
        if(game.nextMatchId) {
          const nextMatch = this.data.playoffGames.find(g => g.id === game.nextMatchId);
          if(nextMatch) nextMatch[game.nextSlot] = winnerId;
        }
      }
    }
    this.saveData();
    this.renderAll();
  }

  undo() {
    if(this.data.history.length > 0) {
      const previousState = this.data.history.pop();
      this.data = { ...previousState, history: this.data.history };
      this.saveData();
      this.renderAll();
      this.setupInputs(); 
      this.showToast('Undone');
    }
  }

  getStandings() {
    const pools = {};
    Object.values(this.data.teams).forEach(t => {
        if (!pools[t.pool]) pools[t.pool] = [];
        pools[t.pool].push(t);
    });
    Object.keys(pools).forEach(p => {
      pools[p].sort((a, b) => {
        if (b.wins !== a.wins) return b.wins - a.wins;
        return a.id.localeCompare(b.id);
      });
    });
    return pools;
  }
  
  getPoolStandingsHtml(pool) {
      const standings = this.getStandings()[pool];
      let html = `<div class="mini-standings"><table class="mini-table"><thead><tr><th>Team</th><th>W-L</th></tr></thead><tbody>`;
      standings.forEach((t, i) => {
          const qualifyClass = i < 2 ? 'row-qualify' : '';
          html += `<tr class="${qualifyClass}"><td>${t.name}</td><td>${t.wins}-${t.losses}</td></tr>`;
      });
      html += `</tbody></table></div>`;
      return html;
  }

  renderAll() {
    // Helper to handle header undo button state
    const undoBtn = document.getElementById('header-undo-btn');
    if (this.data.history && this.data.history.length > 0) {
      undoBtn.style.opacity = '1';
      undoBtn.style.pointerEvents = 'auto';
    } else {
      undoBtn.style.opacity = '0.5';
      undoBtn.style.pointerEvents = 'none';
    }

    this.renderQueue();
    this.renderStandings();
    this.renderBracket();
    requestAnimationFrame(() => this.fitText());
  }

  renderQueue() {
    let html = '';
    const poolNames = Object.keys(this.getStandings()).sort();
    
    if (this.data.phase === 'pool') {
      const allUnplayed = this.data.poolGames.filter(g => !g.winner);
      const remainingCount = allUnplayed.length;

      if (remainingCount === 0) {
        html = `<div class="card" style="text-align:center"><p class="match-info">All games finished.</p><button class="generate-btn" onclick="app.generateBracket()">Start Playoffs</button></div>`;
      } else {
        html += `<div class="games-grid">`;
        poolNames.forEach(pool => {
            const games = this.data.poolGames.filter(g => g.pool === pool && !g.winner);
            const isComplete = games.length === 0;
            const current = games[0];
            const next = games[1];
            const showStandings = this.poolViews[pool] || isComplete;

            html += `<div class="pool-lane-card"><div class="pool-header"><span class="pool-title">Pool ${pool}</span><div class="header-actions"><button class="pool-toggle-btn" onclick="app.showPoolHistory('${pool}')" title="History">üïí</button><button class="pool-toggle-btn ${showStandings?'active':''}" onclick="app.togglePoolStandings('${pool}')" title="Stats">üìä</button></div></div>`;

            if (showStandings) {
                if(isComplete) html += `<div class="pool-status-msg" style="padding:0.5rem 0 0 0">Pool Complete</div>`;
                html += this.getPoolStandingsHtml(pool);
            } else if (current) {
                const h = this.data.teams[current.home];
                const a = this.data.teams[current.away];
                html += `<div class="current-game-section"><div class="section-label">Current</div><div class="game-body"><div class="game-team-btn" onclick="app.recordWin('${current.id}', '${h.id}')"><span class="team-name">${h.name}</span><span class="team-record">${h.wins}-${h.losses}</span></div><div class="vs-text">VS</div><div class="game-team-btn blue" onclick="app.recordWin('${current.id}', '${a.id}')"><span class="team-name">${a.name}</span><span class="team-record">${a.wins}-${a.losses}</span></div></div></div>`;

                if (next) {
                    const nh = this.data.teams[next.home];
                    const na = this.data.teams[next.away];
                    html += `<div class="on-deck-section"><div class="section-label">On Deck</div><div class="on-deck-row"><span class="deck-team">${nh.name}</span><span class="deck-vs">vs</span><span class="deck-team">${na.name}</span></div></div>`;
                } else {
                    html += `<div class="on-deck-section"><div class="section-label">On Deck</div><div class="on-deck-row" style="opacity:0.5;">End of Pool</div></div>`;
                }
            } 
            html += `</div>`;
        });
        html += `</div>`;
      }
    } else {
      // Playoff Queue Logic (simplified for brevity)
      html += `<div class="card" style="text-align:center"><p>Playoffs in Progress. Check Bracket.</p></div>`;
    }
    
    this.ui.queue.innerHTML = html;
  }

  renderStandings() {
    const pools = this.getStandings();
    let html = '<div class="games-grid">';
    Object.entries(pools).forEach(([poolName, teams]) => {
      html += `<div class="pool-lane-card" style="height:auto;"><div class="pool-header"><span class="pool-title">Pool ${poolName}</span></div><table class="mini-table"><thead><tr><th style="padding-left:1rem;">#</th><th>Team</th><th>W</th><th>L</th></tr></thead><tbody>`;
      teams.forEach((t, index) => {
        const isQualifying = index < 2; 
        const rowStyle = isQualifying ? 'background:rgba(34, 197, 94, 0.05);' : '';
        const rankColor = isQualifying ? 'color:var(--brand); font-weight:bold;' : 'color:var(--text-muted);';
        html += `<tr style="${rowStyle}"><td style="padding-left:1rem; ${rankColor}">${index + 1}</td><td style="font-weight:500;">${t.name}</td><td style="font-weight:bold;">${t.wins}</td><td style="opacity:0.7;">${t.losses}</td></tr>`;
      });
      html += `</tbody></table></div>`;
    });
    html += '</div>';
    this.ui.standings.innerHTML = html;
  }

  renderBracket() {
    // 1. Capture current scroll
    const container = this.ui.bracket.querySelector('.bracket-container');
    const scrollLeft = container ? container.scrollLeft : 0;
    const scrollTop = container ? container.scrollTop : 0;

    let title = '';
    let matches = [];
    let championHtml = '';
    
    const poolKeys = Object.keys(this.getStandings());
    const isSmallBracket = poolKeys.length === 2;

    // DATA GATHERING
    if (this.data.phase === 'pool') {
        title = '<div class="bracket-projected-header">Projected Bracket (Live Standings)</div>';
        const s = this.getStandings();
        
        if (isSmallBracket) {
            // 8 Team Logic
            matches = [
                { round: 'Semifinals', home: s.A?s.A[0].id:null, away: s.B?s.B[1].id:null, id: 'semi1' },
                { round: 'Semifinals', home: s.B?s.B[0].id:null, away: s.A?s.A[1].id:null, id: 'semi2' },
                { round: 'Finals', home: null, away: null, id: 'final' }
            ];
        } else {
            // 16+ Team Logic
            matches = [
                { round: 'Quarterfinals', home: s.A[0].id, away: s.B[1].id, id: 'qf1' },
                { round: 'Quarterfinals', home: s.D[0].id, away: s.C[1].id, id: 'qf2' },
                { round: 'Quarterfinals', home: s.B[0].id, away: s.A[1].id, id: 'qf3' },
                { round: 'Quarterfinals', home: s.C[0].id, away: s.D[1].id, id: 'qf4' },
                { round: 'Semifinals', home: null, away: null, id: 'semi1' },
                { round: 'Semifinals', home: null, away: null, id: 'semi2' },
                { round: 'Finals', home: null, away: null, id: 'final' }
            ];
        }
    } else {
        matches = this.data.playoffGames;
        
        // CHECK FOR CHAMPION
        const finalMatch = matches.find(g => g.id === 'final');
        if (finalMatch && finalMatch.winner) {
            const winnerName = this.data.teams[finalMatch.winner].name;
            championHtml = `
                <div class="champion-banner">
                    <div class="champ-title">üèÜ 2025 CHAMPIONS üèÜ</div>
                    <div class="champ-name">${winnerName}</div>
                </div>
            `;
        }
    }

    // HELPER: RENDER SINGLE CARD
    const renderCard = (matchId, roundClass) => {
        const m = matches.find(g => g.id === matchId);
        if(!m) return '<div class="bracket-node"></div>';

        const hName = m.home ? this.data.teams[m.home].name : 'TBD';
        const aName = m.away ? this.data.teams[m.away].name : 'TBD';
        const active = (m.home && m.away && !m.winner) ? 'active' : '';
        
        // Winner/Loser classes
        const hClass = m.winner === m.home && m.winner ? 'winner' : (m.winner ? 'loser' : '');
        const aClass = m.winner === m.away && m.winner ? 'winner' : (m.winner ? 'loser' : '');

        // Click handlers only if active and teams exist
        const hClick = (active && m.home) ? `onclick="event.stopPropagation(); app.recordWin('${m.id}', '${m.home}')"` : '';
        const aClick = (active && m.away) ? `onclick="event.stopPropagation(); app.recordWin('${m.id}', '${m.away}')"` : '';
        
        // Hover class for individual teams if active
        const hHover = (active && m.home) ? 'team-pick' : '';
        const aHover = (active && m.away) ? 'team-pick' : '';

        return `
            <div class="bracket-node ${roundClass}">
                <div class="bracket-match-card ${active}">
                    <div class="b-team ${hClass} ${hHover}" ${hClick}>${hName}</div>
                    <div class="b-team ${aClass} ${aHover}" style="border-top:1px solid #eee;" ${aClick}>${aName}</div>
                </div>
            </div>
        `;
    };

    // GENERATE GRID HTML
    let containerClass = isSmallBracket ? "bracket-container small-bracket" : "bracket-container";
    let html = title + `<div class="${containerClass}">`;
    
    if (isSmallBracket) {
        // SMALL BRACKET (3 Columns)
        html += '<div class="bracket-header-cell" style="grid-column:1;">Semifinals</div>';
        html += '<div class="bracket-header-cell" style="grid-column:2;">Championship</div>';
        html += '<div class="bracket-header-cell" style="grid-column:3;">Semifinals</div>';
        
        // SEMI 1
        html += renderCard('semi1', 'node-semi1');
        // SEMI 2
        html += renderCard('semi2', 'node-semi2');
        // FINAL
        html += renderCard('final', 'node-final');
    } else {
        // STANDARD BRACKET (5 Columns)
        html += '<div class="bracket-header-cell" style="grid-column:1;">Quarterfinals</div>';
        html += '<div class="bracket-header-cell" style="grid-column:2;">Semifinals</div>';
        html += '<div class="bracket-header-cell" style="grid-column:3;">Championship</div>';
        html += '<div class="bracket-header-cell" style="grid-column:4;">Semifinals</div>';
        html += '<div class="bracket-header-cell" style="grid-column:5;">Quarterfinals</div>';

        // QF1
        html += renderCard('qf1', 'node-qf1');
        // QF2
        html += renderCard('qf2', 'node-qf2');
        // QF3
        html += renderCard('qf3', 'node-qf3');
        // QF4
        html += renderCard('qf4', 'node-qf4');
        
        // SEMI 1
        html += renderCard('semi1', 'node-semi1');
        // SEMI 2
        html += renderCard('semi2', 'node-semi2');
        
        // FINAL
        html += renderCard('final', 'node-final');
    }

    html += '</div>';
    // Append Champion Banner
    html += championHtml;
    
    this.ui.bracket.innerHTML = html;

    // 2. Restore scroll
    const newContainer = this.ui.bracket.querySelector('.bracket-container');
    if (newContainer) {
        newContainer.scrollLeft = scrollLeft;
        newContainer.scrollTop = scrollTop;
    }
  }
  
  jumpToMatch(id) {}

  showToast(msg) {
    this.ui.toast.textContent = msg;
    this.ui.toast.classList.add('show');
    setTimeout(() => this.ui.toast.classList.remove('show'), 2000);
  }
}

const app = new TournamentApp();
</script>
</body>
</html>
